{% extends 'components/base.html' %}

{% block head %}
{% endblock %}

{% block content %}

<div>
    <h1 style="font-size: 2rem;">Requisição de usuários</h1>
    {% for user in users %}
        <p>{{ user }}</p>
        <hr>
    {% endfor %}
</div>

<div>
    <h1 style="font-size: 2rem;">Requisição de movimentação</h1>
    {% for request in requests_movement %}
        <div>
            <p>{{ request }}</p>
            <p>{{ request.fk_movement.motivation }}</p>
            <button class="approve-button" data-id="{{ request.id }}">Aprovar</button>
        </div>
        <hr>
    {% endfor %}
</div>

{% endblock %}

{% block scripts %}
<script>
    const approveButtons = document.querySelectorAll('.approve-button');

    approveButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Obtém o ID da requisição de movimentação do atributo data-id
            const requestId = this.getAttribute('data-id');

            // Monta a URL dinamicamente de acordo com a url do django
            const url = `{% url 'approve_request_movement' %}?id=${requestId}`;

            // Faz uma requisição GET para a API de aprovação usando Fetch
            fetch(url, {
                method: 'GET'
            })
            .then(response => response.json())  // Converte a resposta em JSON
            .then(data => {
                if (data.message) {
                    alert('Requisição aprovada com sucesso!');
                    this.parentElement.style.display = 'none';
                } else if (data.error) {
                    alert('Erro: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Erro ao aprovar a requisição:', error);
                alert('Ocorreu um erro ao aprovar a requisição.');
            });
        });
    });
</script>
{% endblock %}
